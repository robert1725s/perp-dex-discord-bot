# Perp DEX Discordé€šçŸ¥BOT

è¤‡æ•°ã®Perpetual DEXï¼ˆåˆ†æ•£å‹æ°¸ä¹…å…ˆç‰©å–å¼•æ‰€ï¼‰ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚’å®šæœŸçš„ã«ç›£è¦–ã—ã€å–å¼•æ©Ÿä¼šã‚’Discordã«è‡ªå‹•é€šçŸ¥ã™ã‚‹BOTã§ã™ã€‚

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®BOTã¯ã€è¤‡æ•°ã®å–å¼•æ‰€ã‹ã‚‰å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚’ä¸¦åˆ—å–å¾—ã—ã€Funding Rateï¼ˆè³‡é‡‘èª¿é”ç‡ï¼‰ã®å·®ã‚„Open Interestï¼ˆå»ºç‰ï¼‰æ¯”ç‡ã‚’åˆ†æã—ã¦ã€åç›Šæ©Ÿä¼šã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™ã€‚

### ä¸»ãªç‰¹å¾´

- **ãƒãƒ«ãƒå–å¼•æ‰€å¯¾å¿œ**: Extendedï¼ˆStarknetï¼‰ã€Lighterï¼ˆzkSyncï¼‰ãªã©è¤‡æ•°ã®å–å¼•æ‰€ã«å¯¾å¿œ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ**: éåŒæœŸå‡¦ç†ã«ã‚ˆã‚‹é«˜é€Ÿãªãƒ‡ãƒ¼ã‚¿å–å¾—ã¨åˆ†æ
- **æŸ”è»Ÿãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°**: Cronå½¢å¼ã§è‡ªç”±ã«å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¨­å®šå¯èƒ½
- **æ‹¡å¼µæ€§**: ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šæ–°ã—ã„å–å¼•æ‰€ã‚’ç°¡å˜ã«è¿½åŠ å¯èƒ½
- **å …ç‰¢æ€§**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚‹å®‰å®šå‹•ä½œ

## ğŸ¯ æ©Ÿèƒ½

### å¸‚å ´åˆ†ææ©Ÿèƒ½

1. **Funding Rateå·®åˆ†æ**
   - 2ã¤ã®å–å¼•æ‰€é–“ã®FRå·®ã‚’æ¤œå‡º
   - å–å¼•é«˜ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   - å·®ã®å¤§ãã„é †ã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º

2. **OIæ¯”ç‡åˆ†æ**
   - Open Interest / Volume æ¯”ç‡ã‚’è¨ˆç®—
   - å–å¼•é«˜ç¯„å›²ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   - ä½OIæ¯”ç‡ï¼ˆæµå‹•æ€§æ©Ÿä¼šï¼‰ã‚’æ¤œå‡º

3. **å…±é€šãƒšã‚¢ç®¡ç†**
   - è¤‡æ•°å–å¼•æ‰€ã®å…±é€šå–å¼•ãƒšã‚¢ã‚’è‡ªå‹•æŠ½å‡º
   - æ—¥æ¬¡æ›´æ–°ã¾ãŸã¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—æ™‚æ›´æ–°
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹é«˜é€ŸåŒ–

### é€šçŸ¥æ©Ÿèƒ½

- **Discord Webhooké€šçŸ¥**
  - ãƒªãƒƒãƒãªEmbedå½¢å¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã®è¦‹ã‚„ã™ã„è¡¨ç¤º
  - ã‚¨ãƒ©ãƒ¼é€šçŸ¥æ©Ÿèƒ½

## ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å–å¼•æ‰€

- Extended (Starknet)
- Lighter (zkSync)

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
perp-dex-discord-bot/
â”œâ”€â”€ config.yaml              # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ main.py                  # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ scheduler.py             # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ç®¡ç†
â”œâ”€â”€ requirements.txt         # Pythonä¾å­˜é–¢ä¿‚
â”‚
â”œâ”€â”€ core/                    # ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ analyzer.py          # ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ common_pairs.py      # å…±é€šãƒšã‚¢ç®¡ç†
â”‚   â””â”€â”€ types.py            # å‹å®šç¾©
â”‚
â”œâ”€â”€ exchanges/               # å–å¼•æ‰€å®Ÿè£…
â”‚   â”œâ”€â”€ base.py             # æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”œâ”€â”€ extended.py         # Extendedå–å¼•æ‰€å®Ÿè£…
â”‚   â”œâ”€â”€ lighter.py          # Lighterå–å¼•æ‰€å®Ÿè£…
â”‚   â””â”€â”€ factory.py          # å–å¼•æ‰€ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼
â”‚
â”œâ”€â”€ notifiers/              # é€šçŸ¥å®Ÿè£…
â”‚   â”œâ”€â”€ discord.py          # Discordé€šçŸ¥
â”‚   â””â”€â”€ formatter.py        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
â”‚
â””â”€â”€ storage/                # ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
    â””â”€â”€ cache.py            # å…±é€šãƒšã‚¢ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ç’°å¢ƒæº–å‚™

Python 3.9ä»¥ä¸ŠãŒå¿…è¦ã§ã™ã€‚

```bash
# ä»®æƒ³ç’°å¢ƒã®ä½œæˆ
python -m venv venv

# ä»®æƒ³ç’°å¢ƒã®æœ‰åŠ¹åŒ–
# macOS/Linux:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä½œæˆï¼š

```bash
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_WEBHOOK_URL
```

### 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†

`config.yaml`ã‚’ç·¨é›†ã—ã¦ã€åˆ†æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚

## ä½¿ç”¨æ–¹æ³•

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
# ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
python main.py --help

# é€šå¸¸èµ·å‹•ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼‰
python main.py

# ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆ1å›ã ã‘å®Ÿè¡Œï¼‰
python main.py --once

# ã‚«ã‚¹ã‚¿ãƒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨
python main.py --config my_config.yaml

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤º
python main.py --version
```

### Discord Webhookã®å–å¾—æ–¹æ³•

1. Discordã‚µãƒ¼ãƒãƒ¼è¨­å®šã‚’é–‹ã
2. ã€Œé€£æºã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã€ã«ç§»å‹•
3. ã€Œæ–°ã—ã„ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. Webhook URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®š

### å®Ÿè¡Œä¾‹

```bash
# 1. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
export DISCORD_WEBHOOK_URL='https://discord.com/api/webhooks/...'

# 2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆ1å›ã ã‘ï¼‰
python main.py --once

# 3. æ­£å¸¸å‹•ä½œã‚’ç¢ºèªå¾Œã€æœ¬ç•ªèµ·å‹•
python main.py
```

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š

`config.yaml`ã§ä»¥ä¸‹ã®è¨­å®šãŒå¯èƒ½ã§ã™ï¼š

- **é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**: Cronå½¢å¼ã§æŒ‡å®šï¼ˆä¾‹: `45 * * * *` = æ¯æ™‚45åˆ†ï¼‰
- **å–å¼•æ‰€ã®æœ‰åŠ¹/ç„¡åŠ¹**: `enabled: true/false`
- **åˆ†æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: æœ€å°å–å¼•é«˜ã€ä¸Šä½ä»¶æ•°ãªã©
- **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«**: DEBUG, INFO, WARNING, ERROR

#### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾‹

```yaml
schedule:
  common_pairs_update: "daily"  # å…±é€šãƒšã‚¢æ›´æ–°: daily or startup
  notification_time: "45 * * * *"  # æ¯æ™‚45åˆ†ã«é€šçŸ¥

# ãã®ä»–ã®ä¾‹:
# "0 * * * *"   - æ¯æ™‚0åˆ†
# "0 9 * * *"   - æ¯æ—¥9:00
# "0 9,21 * * *" - æ¯æ—¥9:00ã¨21:00
# "0 0 * * 1"   - æ¯é€±æœˆæ›œæ—¥0:00
```

### ãƒ­ã‚°ã®ç¢ºèª

```bash
# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
tail -f logs/bot.log

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ­ã‚°ã‚’ç¢ºèª
python main.py  # æ¨™æº–å‡ºåŠ›ã«ã‚‚ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
```

## âš™ï¸ è¨­å®šã®è©³ç´°

### config.yaml ã®ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

#### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š

```yaml
schedule:
  # å…±é€šãƒšã‚¢ã®æ›´æ–°é »åº¦
  common_pairs_update: "daily"  # dailyï¼ˆæ¯æ—¥0:00ï¼‰ã¾ãŸã¯ startupï¼ˆèµ·å‹•æ™‚ã®ã¿ï¼‰

  # å¸‚å ´åˆ†æã¨é€šçŸ¥ã®å®Ÿè¡Œæ™‚åˆ»ï¼ˆCronå½¢å¼ï¼‰
  notification_time: "45 * * * *"  # æ¯æ™‚45åˆ†
```

#### åˆ†æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```yaml
analysis:
  # Funding Rateå·®åˆ†æ
  fr_divergence:
    min_volume_usd: 1000000  # æœ€å°å–å¼•é«˜ï¼ˆ1M USDï¼‰
    top_n: 5                  # ä¸Šä½ä½•ä»¶ã‚’é€šçŸ¥ã™ã‚‹ã‹

  # OIæ¯”ç‡åˆ†æ
  oi_ratio:
    min_volume_usd: 10000000  # æœ€å°å–å¼•é«˜ï¼ˆ10M USDï¼‰
    max_volume_usd: 30000000  # æœ€å¤§å–å¼•é«˜ï¼ˆ30M USDï¼‰
    top_n: 3                   # ä¸Šä½ä½•ä»¶ã‚’é€šçŸ¥ã™ã‚‹ã‹
    base_exchange: "Extended"  # åˆ†æå¯¾è±¡ã®å–å¼•æ‰€
```

#### ãƒ­ã‚°è¨­å®š

```yaml
logging:
  level: "INFO"         # DEBUG, INFO, WARNING, ERROR
  file: "logs/bot.log"  # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ç’°å¢ƒå¤‰æ•°ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼**: `Environment variable 'DISCORD_WEBHOOK_URL' is not set`

**è§£æ±ºæ–¹æ³•**:
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cp .env.example .env

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦Webhook URLã‚’è¨­å®š
echo "DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_ID/YOUR_TOKEN" > .env
```

#### 2. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼**: `ModuleNotFoundError: No module named 'apscheduler'`

**è§£æ±ºæ–¹æ³•**:
```bash
# ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ã¾ãŸã¯å€‹åˆ¥ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install APScheduler aiohttp PyYAML python-dotenv
```

#### 3. Discordé€šçŸ¥ãŒé€ä¿¡ã•ã‚Œãªã„

**ç—‡çŠ¶**: ãƒ­ã‚°ã«ã€ŒFailed to send Discord notificationã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹

**è§£æ±ºæ–¹æ³•**:
1. Webhook URLãŒæ­£ã—ã„ã‹ç¢ºèª
   ```bash
   # Webhook URLã®å½¢å¼ã‚’ç¢ºèª
   echo $DISCORD_WEBHOOK_URL
   # æ­£ã—ã„å½¢å¼: https://discord.com/api/webhooks/ID/TOKEN
   ```

2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª
   ```bash
   # ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ä¿¡
   python test_discord_webhook.py
   ```

3. Discordã‚µãƒ¼ãƒãƒ¼ã®æ¨©é™ã‚’ç¢ºèª
   - WebhookãŒå‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã‹
   - ã‚µãƒ¼ãƒãƒ¼ã®æ¨©é™è¨­å®šãŒæ­£ã—ã„ã‹

#### 4. APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼**: `Failed to fetch markets from Extended`

**è§£æ±ºæ–¹æ³•**:
1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª
2. å–å¼•æ‰€APIã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª
3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ã¦ã„ãªã„ã‹ç¢ºèªï¼ˆconfig.yamlã®rate_limitã‚’èª¿æ•´ï¼‰

```yaml
exchanges:
  - name: "Extended"
    config:
      rate_limit: 500  # ä½ã„å€¤ã«å¤‰æ›´ã—ã¦ãƒ†ã‚¹ãƒˆ
```

#### 5. å…±é€šãƒšã‚¢ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç—‡çŠ¶**: `No common pairs found`

**è§£æ±ºæ–¹æ³•**:
1. å„å–å¼•æ‰€ãŒæ­£å¸¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
   ```bash
   # ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
   python main.py --once
   ```

2. ãƒ­ã‚°ã§å„å–å¼•æ‰€ã®å–å¾—ãƒãƒ¼ã‚±ãƒƒãƒˆæ•°ã‚’ç¢ºèª
   ```
   INFO - Fetched 91 markets from Extended
   INFO - Fetched 102 markets from Lighter
   ```

3. ã‚·ãƒ³ãƒœãƒ«æ­£è¦åŒ–ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª

#### 6. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå‹•ä½œã—ãªã„

**ç—‡çŠ¶**: ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚Œãªã„

**è§£æ±ºæ–¹æ³•**:
1. Cronè¡¨è¨˜ãŒæ­£ã—ã„ã‹ç¢ºèª
   ```yaml
   # æ­£ã—ã„å½¢å¼: "åˆ† æ™‚ æ—¥ æœˆ æ›œæ—¥"
   notification_time: "45 * * * *"  # âœ“ æ­£ã—ã„
   notification_time: "every hour"   # âœ— é–“é•ã„
   ```

2. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ãƒ­ã‚°ã‚’ç¢ºèª
   ```bash
   tail -f logs/bot.log | grep "SCHEDULED JOBS"
   ```

3. ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ç¢ºèªï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã¯UTCã‚’ä½¿ç”¨ï¼‰

### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´

å•é¡Œã‚’è©³ã—ãèª¿æŸ»ã™ã‚‹å ´åˆã¯ã€ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’DEBUGã«å¤‰æ›´ï¼š

```yaml
logging:
  level: "DEBUG"  # è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›
```

## ğŸ”Œ æ–°ã—ã„å–å¼•æ‰€ã®è¿½åŠ æ–¹æ³•

æ–°ã—ã„å–å¼•æ‰€ã‚’è¿½åŠ ã™ã‚‹è©³ç´°ãªæ‰‹é †ã§ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—1: å–å¼•æ‰€ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…

`exchanges/newexchange.py` ã‚’ä½œæˆ:

```python
"""NewExchange implementation."""

import aiohttp
from typing import List, Dict
from .base import BaseExchange


class NewExchange(BaseExchange):
    """NewExchangeå®Ÿè£…"""

    def __init__(self, config: Dict):
        super().__init__(config)
        self.timeout = aiohttp.ClientTimeout(total=30)

    async def get_markets(self) -> List[Dict]:
        """
        ãƒãƒ¼ã‚±ãƒƒãƒˆæƒ…å ±ã‚’å–å¾—

        Returns:
            List[Dict]: ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚¹ãƒˆ
        """
        url = f"{self.api_base_url}/markets"

        async with aiohttp.ClientSession(timeout=self.timeout) as session:
            async with session.get(url) as response:
                data = await response.json()

                # ãƒ‡ãƒ¼ã‚¿ã‚’æ¨™æº–å½¢å¼ã«å¤‰æ›
                markets = []
                for item in data['markets']:
                    markets.append({
                        'symbol': self.normalize_symbol(item['symbol']),
                        'volume_24h': float(item['volume']),
                        'funding_rate': float(item['fundingRate']),
                        'open_interest': float(item['openInterest']),
                        'last_price': float(item['price'])
                    })

                return markets

    def normalize_symbol(self, raw_symbol: str) -> str:
        """
        ã‚·ãƒ³ãƒœãƒ«ã‚’æ­£è¦åŒ–

        Args:
            raw_symbol: å–å¼•æ‰€å›ºæœ‰ã®ã‚·ãƒ³ãƒœãƒ«ï¼ˆä¾‹: "BTCUSD"ï¼‰

        Returns:
            str: æ­£è¦åŒ–ã•ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ï¼ˆä¾‹: "BTC-USD"ï¼‰
        """
        # ä¾‹: "BTCUSD" -> "BTC-USD"
        if raw_symbol.endswith('USD'):
            base = raw_symbol[:-3]
            return f"{base}-USD"
        return raw_symbol
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã«ç™»éŒ²

`exchanges/factory.py` ã‚’ç·¨é›†:

```python
from .newexchange import NewExchange  # ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¿½åŠ 

class ExchangeFactory:
    _registry: Dict[str, Type[BaseExchange]] = {
        'extended': ExtendedExchange,
        'lighter': LighterExchange,
        'newexchange': NewExchange,  # è¿½åŠ 
    }
```

### ã‚¹ãƒ†ãƒƒãƒ—3: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 

`config.yaml` ã‚’ç·¨é›†:

```yaml
exchanges:
  - name: "NewExchange"
    type: "newexchange"      # factory.pyã®ã‚­ãƒ¼ã«å¯¾å¿œ
    enabled: true
    api_base_url: "https://api.newexchange.com/v1"
    config:
      rate_limit: 1000        # å–å¼•æ‰€ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«åˆã‚ã›ã¦èª¿æ•´
```

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
python main.py --once

# ãƒ­ã‚°ã§ç¢ºèª
# "Initialized exchange: NewExchange" ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OK
```

### å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®çµ±ä¸€**
   - `get_markets()`ã¯å¿…ãšæ¨™æº–å½¢å¼ã§è¿”ã™
   - `symbol`, `volume_24h`, `funding_rate`, `open_interest`ã¯å¿…é ˆ

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - APIå‘¼ã³å‡ºã—ã¯å¿…ãštry-exceptã§å›²ã‚€
   - ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹

3. **ã‚·ãƒ³ãƒœãƒ«æ­£è¦åŒ–**
   - å…¨ã¦ã®å–å¼•æ‰€ã§çµ±ä¸€ã•ã‚ŒãŸå½¢å¼ï¼ˆä¾‹: "BTC-USD"ï¼‰ã‚’ä½¿ç”¨
   - `normalize_symbol()`ã§å„å–å¼•æ‰€ã®å½¢å¼ã‚’å¤‰æ›

4. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®éµå®ˆ**
   - å„å–å¼•æ‰€ã®APIåˆ¶é™ã‚’ç¢ºèª
   - `config.rate_limit`ã§åˆ¶å¾¡

### ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ¼ãƒ‰

```python
# exchanges/newexchange.py ã®æœ€å¾Œã«è¿½åŠ 
if __name__ == '__main__':
    import asyncio
    import logging

    logging.basicConfig(level=logging.INFO)

    async def test():
        config = {
            'name': 'NewExchange',
            'api_base_url': 'https://api.newexchange.com/v1',
            'config': {'rate_limit': 1000}
        }

        exchange = NewExchange(config)
        markets = await exchange.get_markets()

        print(f"Fetched {len(markets)} markets")
        for market in markets[:3]:
            print(market)

    asyncio.run(test())
```

å®Ÿè¡Œ:
```bash
python -m exchanges.newexchange
```

## ğŸ“š æŠ€è¡“ä»•æ§˜

è©³ç´°ãªæŠ€è¡“ä»•æ§˜ã¯`doc/SPECIFICATION.md`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼ä»¥ä¸‹ã®æµã‚Œã§è²¢çŒ®ã—ã¦ãã ã•ã„ï¼š

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## âš ï¸ å…è²¬äº‹é …ãƒ»æ³¨æ„äº‹é …

- **æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“**: ã“ã®BOTã¯æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€æŠ•è³‡åŠ©è¨€ã‚„æ¨å¥¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“
- **APIãƒ¬ãƒ¼ãƒˆåˆ¶é™**: å„å–å¼•æ‰€ã®APIãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å¿…ãšéµå®ˆã—ã¦ãã ã•ã„
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Discord Webhook URLã¯çµ¶å¯¾ã«å…¬é–‹ã—ãªã„ã§ãã ã•ã„
- **è‡ªå·±è²¬ä»»**: æœ¬BOTã®ä½¿ç”¨ã«ã‚ˆã‚‹æå¤±ã«ã¤ã„ã¦ã€é–‹ç™ºè€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“
- **ãƒ†ã‚¹ãƒˆ**: æœ¬ç•ªç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹å‰ã«ã€å¿…ãšãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œç¢ºèªã—ã¦ãã ã•ã„

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

1. ã¾ãš[ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ğŸ”§-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)ã‚’ç¢ºèª
2. ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯Issueã‚’ä½œæˆ
3. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`logs/bot.log`ï¼‰ã‚’æ·»ä»˜ã™ã‚‹ã¨è§£æ±ºãŒæ—©ããªã‚Šã¾ã™

---

**Happy Trading! ğŸ“ˆ**
